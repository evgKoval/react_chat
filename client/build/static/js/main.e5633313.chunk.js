(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{141:function(e,t,a){e.exports=a(211)},150:function(e,t,a){},172:function(e,t,a){},201:function(e,t){},211:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(8),l=a.n(r),i=a(30),c=a(55),o=a(120),u=a(11),d="ADD_CHAT",m={currentUser:{},users:[],chats:[],messages:{}};var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;if(t.type===d)return Object.assign({},e,{chats:e.chats.concat(t.payload)});if("CHATS_LOADED"===t.type)return Object.assign({},e,{chats:e.chats=t.payload});if("EDIT_CHAT"===t.type){e.chats=Object(u.a)(e.chats);var a=e.chats.findIndex((function(e){return e.id===t.payload.id}));return e.chats[a]=t.payload,Object.assign({},e,{chats:e.chats})}return"USERS_LOADED"===t.type?Object.assign({},e,{users:e.users.concat(t.payload)}):"MESSAGES_LOADED"===t.type?Object.assign({},e,{messages:Object.assign(e.messages,t.payload)}):"ADD_MESSAGE"===t.type?Object.assign({},e,{message:e.messages[t.payload.chat_id].push(t.payload)}):"USER_LOADED"===t.type?Object.assign({},e,{user:e.currentUser=Object(o.a)({},e.currentUser,{},t.payload)}):"LOGOUT"===t.type?Object.assign({},e,{users:e.currentUser={}}):e},g=a(121),p=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.c,f=Object(c.d)(h,p(Object(c.a)(g.a))),v=(a(150),a(34)),E=a(26),y=a(272),b=a(49),w=a.n(b),S=a(251),x=a(254),C=a(256),I=a(58),O=a(257),j=a(124),_=a.n(j),D=a(7),k=a(13),T=a.n(k),F=a(122),A=a.n(F),U=localStorage.getItem("token")||"",N=A.a.create({baseURL:"http://localhost:5000",headers:{"x-access-token":U}});function M(e){return function(t){var a,n;return T.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,T.a.awrap(N.post("/chats",{name:e.name,created_by:e.created_by,users:e.users}));case 2:a=s.sent,n={id:a.data.chat,name:e.name,users:e.users},t({type:d,payload:n});case 5:case"end":return s.stop()}}))}}function q(e){return function(t){var a;return T.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T.a.awrap(N.get("/users/"+e));case 2:a=n.sent,t({type:"USER_LOADED",payload:a.data.user});case 4:case"end":return n.stop()}}))}}var B=Object(S.a)((function(e){return{title:{marginRight:"auto"},icon:{position:"relative",top:5,paddingRight:5}}}));var L=function(e){var t=Object(E.g)(),a=Object(i.c)(),n=localStorage.getItem("token");null!==n&&a(q(w()(n).userId));var r=B();return s.a.createElement(x.a,{position:"static",color:"primary"},s.a.createElement(C.a,null,s.a.createElement(I.a,{variant:"h6",component:v.b,to:"/",className:r.title},s.a.createElement(_.a,{className:r.icon}),"ReactChat"),null===n?s.a.createElement(s.a.Fragment,null,s.a.createElement(O.a,{color:"inherit",component:v.b,to:"/login"},"Login"),s.a.createElement(O.a,{color:"inherit",component:v.b,to:"/register"},"Register")):s.a.createElement(s.a.Fragment,null,s.a.createElement(O.a,{color:"inherit",component:v.b,to:"/profile"},"Profile"),s.a.createElement(O.a,{color:"inherit",onClick:function(){a((function(e){e({type:"LOGOUT"})})),localStorage.removeItem("token"),t.push("/login")}},"Logout"))))},W=a(28),R=a(16),z=a(39),V=a(40),P=a(42),H=(a(172),a(125)),Y=a.n(H),G=a(36),J=a(275),X=a(258),Z=a(267),K=a(259),Q=a(118),$=a(261),ee=a(262),te=a(265),ae=a(264),ne=a(263),se=a(273),re=a(276);var le=function(e){var t=e.open,a=e.onClose,n=e.userId,r=e.users,l=e.edit,c=e.chatId,o=Object(i.c)(),d=s.a.useState([]),m=Object(G.a)(d,2),h=m[0],g=m[1],p=s.a.useState(""),f=Object(G.a)(p,2),v=f[0],E=f[1],y=s.a.useState(!1),b=Object(G.a)(y,2),w=b[0],S=b[1];s.a.useEffect((function(){if(0!==r.length){var e=r.findIndex((function(e){return e.id===n}));0===e&&r.splice(e,1)}l&&N.get("chat/"+c).then((function(e){var t=[];r.map((function(a){for(var n=0;n<e.data.users.length;n++)a.id===e.data.users[n]&&t.push(a.id);return a})),E(e.data.name),g(t)}))}),[n,r,l,c]);var x=function(){a(),g([]),E("")};return s.a.createElement(J.a,{"aria-labelledby":"modal-create",open:t,onClose:x},s.a.createElement(X.a,{id:"simple-dialog-title",style:{width:"480px"}},l?"Edit the chat":"Create a new chat"),s.a.createElement(K.a,null,s.a.createElement(Q.a,{autoFocus:!0,value:v,id:"name",label:"Enter chat name",type:"text",variant:"outlined",fullWidth:!0,style:{marginBottom:16},onChange:function(e){var t;t=e.target.value,E(t),S(!1)},error:w}),s.a.createElement($.a,{dense:!0},r.map((function(e,t){var a,n="checkbox-list-secondary-label-".concat(e.id);return s.a.createElement(ee.a,{key:e.id,button:!0},s.a.createElement(ne.a,null,s.a.createElement(re.a,{src:e.avatar})),s.a.createElement(ae.a,{id:n,primary:e.name}),s.a.createElement(te.a,null,s.a.createElement(se.a,{edge:"end",onChange:(a=e.id,function(){var e=h.indexOf(a),t=Object(u.a)(h);-1===e?t.push(a):t.splice(e,1),g(t)}),checked:-1!==h.indexOf(e.id),inputProps:{"aria-labelledby":n}})))})))),s.a.createElement(Z.a,null,s.a.createElement(O.a,{onClick:x},"Cancel"),l?s.a.createElement(O.a,{onClick:function(){var e;""!==v?(S(!1),o((e={chat_id:c,name:v,created_by:n,users:h},function(t){var a;return T.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:N.put("/chat",{chat_id:e.chat_id,name:e.name,created_by:e.created_by,users:e.users}),a={id:e.chat_id,name:e.name,created_by:e.created_by},t({type:"EDIT_CHAT",payload:a});case 3:case"end":return n.stop()}}))})).then((function(){return a()}))):S(!0)},color:"primary"},"Edit"):s.a.createElement(O.a,{onClick:function(){""!==v?(S(!1),o(M({name:v,created_by:n,users:h})).then((function(){return a()}))):S(!0)},color:"primary"},"Create")))},ie=a(57),ce=a.n(ie),oe=a(212),ue=a(260),de=a(266),me=a(268),he=a(126),ge=a.n(he),pe=a(127),fe=a.n(pe),ve=a(128),Ee=a.n(ve),ye=a(129),be=a.n(ye);function we(e){var t=e.id,a=e.name,n=e.avatar,r=e.own,l=e.type,i=e.handleEdit,c=e.handleDelete,o=e.createdAt,u=s.a.useState(e.text),d=Object(G.a)(u,2),m=d[0],h=d[1],g=s.a.useState(!1),p=Object(G.a)(g,2),f=p[0],v=p[1],E=s.a.useState(""),y=Object(G.a)(E,2),b=y[0],w=y[1],S=s.a.useState(e.edited),x=Object(G.a)(S,2),C=x[0],O=x[1],j=function(e){if("true"===r){var t=e.currentTarget.querySelector("span.message-text").innerHTML;w(t),v(!0)}},_=function(e){var t=e.split("_");return t.shift(),t.join("_")};return s.a.createElement(oe.a,{className:"chat-message "+("true"===r?"chat-message-own ":null)+(f?"full-width":null)},"image/jpeg"===l||"image/png"===l||"image/webp"===l||"image/gif"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{alt:m,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+m,style:{width:"100%",marginTop:8}}),s.a.createElement("span",{className:"created-at"},ce.a.format(new Date(o))))})):"text"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),f?s.a.createElement(ue.a,{defaultValue:b,autoFocus:!0,onBlur:function(e){var a=e.currentTarget;a.value!==m&&""!==a.value?(i(a.value,t),h(a.value),setTimeout((function(){v(!1)}),100),O(!0)):setTimeout((function(){v(!1)}),100)},style:{width:"100%"},endAdornment:s.a.createElement(me.a,{position:"end"},s.a.createElement(de.a,{edge:"end",onClick:function(){c(t)}},s.a.createElement(ge.a,{className:"message-delete"})))}):s.a.createElement(ae.a,{onDoubleClick:j,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(I.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("span",{className:"message-text"},m),C?s.a.createElement(I.a,{variant:"caption"},"edited"):null,s.a.createElement("span",{className:"created-at"},ce.a.format(new Date(o)))))})):"application/pdf"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{onDoubleClick:j,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(I.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("a",{className:"message-pdf",href:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+m},s.a.createElement(fe.a,null),_(m)),s.a.createElement("span",{className:"created-at"},ce.a.format(new Date(o)))))})):"application/x-zip-compressed"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{onDoubleClick:j,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(I.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("a",{className:"message-pdf",href:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+m},s.a.createElement(Ee.a,null),_(m)),s.a.createElement("span",{className:"created-at"},ce.a.format(new Date(o)))))})):s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{onDoubleClick:j,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(I.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("a",{className:"message-pdf",href:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+m},s.a.createElement(be.a,null),_(m)),s.a.createElement("span",{className:"created-at"},ce.a.format(new Date(o)))))})))}var Se=a(269),xe=a(270),Ce=a(214),Ie=a(271),Oe=a(133),je=a.n(Oe),_e=a(130),De=a.n(_e),ke=a(132),Te=a.n(ke),Fe=a(131),Ae=a.n(Fe),Ue=Y.a.connect("http://localhost:5000");var Ne=function(e){function t(e){var a;return Object(W.a)(this,t),(a=Object(z.a)(this,Object(V.a)(t).call(this,e))).handleUploadChat=function(e){var t=e.currentTarget.files[0],n=(new Date).getTime()+"_"+t.name;Ue.emit("chat file",{file:t,fileType:t.type,fileName:n,userId:a.state.userId,chatId:a.state.selectedChatId},(function(){a.setState({messages:[].concat(Object(u.a)(a.state.messages),[{created_at:new Date,text:n,chat_id:a.state.selectedChatId,user_id:a.state.userId,edited:!1,type:t.type,own:"true"}]),messagesFiltered:[].concat(Object(u.a)(a.state.messagesFiltered),[{created_at:new Date,text:n,chat_id:a.state.selectedChatId,user_id:a.state.userId,edited:!1,type:t.type,own:"true"}])})}))},a.state={redirect:!1,error:null,selectedIndex:0,selectedChatId:0,open:!1,userId:0,chats:[],chatsFiltered:[],messages:[],messagesFiltered:[],loadingChats:!0,loadingMessages:!0,access:!1,requestSent:!1,notificate:!1,modalEdit:!1},a.sendInput=s.a.createRef(),a.messagesDiv=s.a.createRef(),a.getChats=null,a}return Object(P.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e,t,a=this;return T.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:t=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(t),n=new Uint8Array(a.length),s=0;s<a.length;++s)n[s]=a.charCodeAt(s);return n},null===(e=localStorage.getItem("token"))?this.setState({redirect:!0}):this.setState({userId:w()(e).userId}),this.props.getChats().then((function(){var t=a.props.chats;if(a.setState({chatsFiltered:t}),0!==t.length){var n=window.location.href,s=!1;n.match(/#(.*)/)&&(s=n.match(/#(.*)/)[1]);var r=t[0].id;s&&(r=parseInt(s));var l=w()(e).userId,i=t.findIndex((function(e){return e.id===r}));a.setState({selectedChatId:r,selectedIndex:i,loadingChats:!1}),Ue.emit("get access",{chatId:r,userId:l})}else a.setState({loadingChats:!1,loadingMessages:!1})})),Ue.on("get access",(function(e){a.setState({access:e}),e&&Ue.emit("get messages",{userId:a.state.userId,chatId:a.state.selectedChatId})})),Ue.on("get messages",(function(e){a.setState({messages:e,messagesFiltered:e,loadingMessages:!1},(function(){a.messagesDiv.current.scrollTop=a.messagesDiv.current.scrollHeight}))})),Ue.on("chat message",(function(e){a.setState({messages:[].concat(Object(u.a)(a.state.messages),[e]),messagesFiltered:[].concat(Object(u.a)(a.state.messages),[e])}),new Notification("".concat(e.name," has sent a message"),{body:e.text,tag:"got-message"+e.id}).onclick=function(t){t.preventDefault(),window.open("http://localhost:3000/#".concat(e.chat_id),"_blank")}})),Ue.on("edit message",(function(e){a.setState({loadingMessages:!0});var t=Object(u.a)(a.state.messages),n=t.findIndex((function(t){return t.id===e.id}));t[n]=e,a.setState({messages:t,messagesFiltered:t,loadingMessages:!1})})),Ue.on("delete message",(function(e){a.setState({loadingMessages:!0});var t=Object(u.a)(a.state.messages),n=t.findIndex((function(t){return t.id===e}));t.splice(n,1),a.setState({messages:t,messagesFiltered:t,loadingMessages:!1})})),Ue.on("get access",(function(e){e?(Ue.emit("get messages",{userId:a.state.userId,chatId:a.state.selectedChatId}),a.setState({access:e})):a.setState({access:e,loadingMessages:!1})})),this.props.getUsers(),navigator.serviceWorker.ready.then((function(e){var n={userVisibleOnly:!0,applicationServerKey:t("BBZeRDMeH6fL2sXZ9ILBxn7-f9pVWtnWmJ-6mbaEkdbZnFu2Q0DPrICFllzaFlvAu5gV5qtLFYBFd7jp2TFUHK8")};e.pushManager.subscribe(n).then((function(e){a.setState({notificate:!0})}),(function(e){console.log(e)}))}));case 12:case"end":return n.stop()}}),null,this)}},{key:"handleSearchChat",value:function(e){var t=Object(u.a)(this.props.chats);""===e&&this.setState({chatsFiltered:t});var a=t.filter((function(t){return t.name.toLowerCase().includes(e)}));this.setState({chatsFiltered:a})}},{key:"handleSearchMessage",value:function(e){var t=Object(u.a)(this.state.messages);""===e&&this.setState({messagesFiltered:t});var a=t.filter((function(t){return t.text.toLowerCase().includes(e)}));console.log(a),this.setState({messagesFiltered:a})}},{key:"handleSendMessage",value:function(){var e;return T.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.a.awrap(this.sendInput.current.querySelector("input"));case 2:if(""!==(e=t.sent).value){t.next=5;break}return t.abrupt("return");case 5:Ue.emit("chat message",{userId:this.state.userId,chatId:this.state.selectedChatId,text:e.value}),this.setState({messages:[].concat(Object(u.a)(this.state.messages),[{created_at:new Date,text:e.value,chat_id:this.state.selectedChatId,user_id:this.state.userId,edited:!1,type:"text",own:"true"}]),messagesFiltered:[].concat(Object(u.a)(this.state.messagesFiltered),[{created_at:new Date,text:e.value,chat_id:this.state.selectedChatId,user_id:this.state.userId,edited:!1,type:"text",own:"true"}])}),e.value="";case 8:case"end":return t.stop()}}),null,this)}},{key:"render",value:function(){var e=this;if(this.state.redirect)return s.a.createElement(E.a,{to:"/login"});var t=function(){e.setState({open:!0})},a=function(t,a){Ue.emit("edit message",{text:t,messageId:a,chatId:e.state.selectedChatId})},n=function(t){Ue.emit("delete message",{messageId:t,chatId:e.state.selectedChatId})};return s.a.createElement(oe.a,{style:{marginTop:32,height:"624px",marginBottom:32}},s.a.createElement(Se.a,{container:!0},s.a.createElement(Se.a,{item:!0,xs:3,style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"624px"}},s.a.createElement($.a,{component:"nav",className:"chat-list"},s.a.createElement(ee.a,{button:!0,style:{paddingTop:"12px",paddingBottom:"12px"},onClick:t,className:"btn-new-chat"},s.a.createElement(xe.a,null,s.a.createElement(De.a,null)),s.a.createElement(ae.a,{primary:"Create a new chat",className:"btn-new-chat-text"})),s.a.createElement("div",{className:"chats"},!0===this.state.loadingChats?s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(Ie.a,{color:"secondary",size:30,style:{textAlign:"center"}})):0===this.state.chatsFiltered.length?s.a.createElement("h5",{style:{textAlign:"center"}},"There are no chats by this query"):this.state.chatsFiltered.map((function(a,n){return s.a.createElement(ee.a,{key:n,button:!0,selected:e.state.selectedIndex===n,onClick:function(t){return function(t,a){e.setState({requestSent:!1}),Ue.emit("leave chat",{chatId:e.state.selectedChatId}),e.setState({selectedIndex:t,selectedChatId:a,loadingMessages:!0}),Ue.emit("get access",{chatId:a,userId:e.state.userId}),e.sendInput.current.querySelector("input").value=""}(n,a.id)}},s.a.createElement(ae.a,{primary:a.name}),a.created_by===e.state.userId?s.a.createElement(Ae.a,{className:"chat-icon",onClick:function(){a.id,e.setState({modalEdit:!0}),t()}}):null)})))),s.a.createElement(Q.a,{id:"chat-search",label:"Search by chat name",variant:"filled",fullWidth:!0,onChange:function(t){e.handleSearchChat(t.target.value)}})),s.a.createElement(Se.a,{item:!0,xs:9,style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"624px",borderLeft:"1px solid rgba(0, 0, 0, .14)"}},s.a.createElement(Q.a,{id:"message-search",label:"Search by message",variant:"filled",fullWidth:!0,onChange:function(t){e.handleSearchMessage(t.target.value)}}),s.a.createElement("div",{ref:this.messagesDiv,className:"chat-messages"},!0===this.state.loadingMessages?s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(Ie.a,{color:"secondary",style:{textAlign:"center"}})):this.state.access?0===this.state.messagesFiltered.length?s.a.createElement("h3",{style:{textAlign:"center"}},"There are no messages in this chat"):this.state.messagesFiltered.map((function(e,t){return s.a.createElement(we,{key:e.id,id:e.id,name:e.name,avatar:e.avatar,text:e.text,own:e.own,type:e.type,edited:e.edited,handleEdit:a,handleDelete:n,createdAt:e.created_at})})):s.a.createElement(s.a.Fragment,null,s.a.createElement("h3",{style:{textAlign:"center"}},"You have no permission to join this chat"),this.state.requestSent?s.a.createElement("h4",{style:{textAlign:"center",marginTop:0}},"Request has been sent"):s.a.createElement(O.a,{variant:"contained",color:"secondary",onClick:function(){var t=e.props.chats.filter((function(t){return t.id===e.state.selectedChatId}));N.post("/request",{chat_id:e.state.selectedChatId,chat_name:t[0].name,user_id:e.state.userId,user_name:e.props.currentUser.name,user_email:e.props.currentUser.email}).then((function(){return e.setState({requestSent:!0})}))}},"Send a request to join"))),s.a.createElement(oe.a,{className:"message-form"},s.a.createElement(Ce.a,{className:"message-input",placeholder:"...",ref:this.sendInput}),s.a.createElement("input",{style:{display:"none"},id:"icon-button-file",type:"file",onChange:this.handleUploadChat}),s.a.createElement("label",{htmlFor:"icon-button-file"},s.a.createElement(de.a,{color:"primary","aria-label":"upload picture",component:"span"},s.a.createElement(Te.a,null))),s.a.createElement(de.a,{className:"message-icon","aria-label":"search",onClick:function(t){return e.handleSendMessage(t)}},s.a.createElement(je.a,{color:"primary"}))))),s.a.createElement(le,{open:this.state.open,onClose:function(){e.setState({open:!1,modalEdit:!1})},userId:this.state.userId,users:this.props.users,edit:this.state.modalEdit,chatId:this.state.selectedChatId}))}}]),t}(s.a.Component),Me=Object(i.b)((function(e){return{chats:e.chats,users:e.users,messages:e.messages,currentUser:e.currentUser}}),(function(e){return{addChat:function(t){return e(M(t))},getChats:function(){return e((function(e){var t;return T.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,T.a.awrap(N.get("/chats"));case 2:t=a.sent,e({type:"CHATS_LOADED",payload:t.data.chats});case 4:case"end":return a.stop()}}))}))},getUsers:function(){return e((function(e){var t;return T.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,T.a.awrap(N.get("/users"));case 2:t=a.sent,e({type:"USERS_LOADED",payload:t.data.users});case 4:case"end":return a.stop()}}))}))},getMessagesByChatId:function(t){return e(function(e){return function(t){var a,n;return T.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,T.a.awrap(N.get("chats/"+e+"/messages/"));case 2:a=s.sent,n=Object(D.a)({},e,a.data.messages),t({type:"MESSAGES_LOADED",payload:n});case 5:case"end":return s.stop()}}))}}(t))},sendMessage:function(t){return e((a=t,function(e){var t;return T.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T.a.awrap(N.post("/chats/messages",{chat_id:a.chat_id,text:a.text}));case 2:(t=n.sent).data.message.own="true",e({type:"ADD_MESSAGE",payload:t.data.message});case 5:case"end":return n.stop()}}))}));var a}}}))(Ne),qe=a(18),Be=a(22),Le=function(e){function t(e){var a;return Object(W.a)(this,t),(a=Object(z.a)(this,Object(V.a)(t).call(this,e))).state={email:"",password:"",error:null},a.handleChange=a.handleChange.bind(Object(qe.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(qe.a)(a)),a}return Object(P.a)(t,e),Object(R.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name;this.setState(Object(D.a)({},a,t.value))}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),N.post("/login",{email:this.state.email,password:this.state.password}).then((function(e){localStorage.setItem("token",e.data.token),t.setState({redirect:!0})})).catch((function(e){return t.setState({error:e.response.data.message})}))}},{key:"render",value:function(){return this.state.redirect?s.a.createElement(E.a,{to:"/"}):s.a.createElement(Be.ValidatorForm,{onSubmit:this.handleSubmit,style:{marginBottom:32}},s.a.createElement("h1",{style:{marginBottom:24}},"Login"),s.a.createElement(Be.TextValidator,{name:"email",label:"Your email",variant:"outlined",value:this.state.email,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","isEmail"],errorMessages:["This field is required","Email is not valid"]}),s.a.createElement(Be.TextValidator,{name:"password",type:"password",label:"Password",variant:"outlined",value:this.state.password,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","minStringLength:6"],errorMessages:["This field is required","This field must be equal 6 or more symbols"]}),s.a.createElement(O.a,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0},"Sign In"),null!=this.state.error?s.a.createElement("h3",{className:"text-error"},this.state.error):null)}}]),t}(s.a.Component),We=function(e){function t(e){var a;return Object(W.a)(this,t),(a=Object(z.a)(this,Object(V.a)(t).call(this,e))).state={name:"",email:"",password:"",redirect:!1,error:null},a.handleChange=a.handleChange.bind(Object(qe.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(qe.a)(a)),a}return Object(P.a)(t,e),Object(R.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name;this.setState(Object(D.a)({},a,t.value))}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),N.post("/register",{name:this.state.name,email:this.state.email,password:this.state.password}).then((function(e){t.setState({redirect:!0})})).catch((function(e){return t.setState({error:e.response.data.message})}))}},{key:"render",value:function(){return this.state.redirect?s.a.createElement(E.a,{to:"/login"}):s.a.createElement(Be.ValidatorForm,{onSubmit:this.handleSubmit,style:{marginBottom:32}},s.a.createElement("h1",{style:{marginBottom:24}},"Register"),s.a.createElement(Be.TextValidator,{name:"name",label:"Your name",variant:"outlined",value:this.state.name,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","minStringLength:2"],errorMessages:["This field is required","This field must be equal 2 or more symbols"]}),s.a.createElement(Be.TextValidator,{name:"email",label:"Your email",variant:"outlined",value:this.state.email,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","isEmail"],errorMessages:["This field is required","Email is not valid"]}),s.a.createElement(Be.TextValidator,{name:"password",type:"password",label:"Password",variant:"outlined",value:this.state.password,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","minStringLength:6"],errorMessages:["This field is required","This field must be equal 6 or more symbols"]}),s.a.createElement(O.a,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0},"Sign Up"),null!=this.state.error?s.a.createElement("h3",{className:"text-error"},this.state.error):null)}}]),t}(s.a.Component);var Re=function(e){function t(e){var a;return Object(W.a)(this,t),(a=Object(z.a)(this,Object(V.a)(t).call(this,e))).handleChange=function(e){var t=e.target,n=t.name;a.setState(Object(D.a)({},n,t.value))},a.handleSubmit=function(e){e.preventDefault(),""!==a.state.name&&""!==a.state.email&&a.props.updateUser({file:a.state.file,fileName:a.state.fileName,name:a.state.name,email:a.state.email})},a.handleUpload=function(e){e.preventDefault();var t=new FileReader,n=e.currentTarget.files[0];t.onloadend=function(){a.setState({file:n,fileName:a.props.currentUser.id+"_"+n.name,avatar:t.result})},t.readAsDataURL(n)},a.state={redirect:!1,error:null,name:"",email:"",avatar:null,file:null,fileName:""},a}return Object(P.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e,t,a=this;return T.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:(e=localStorage.getItem("token"))||this.setState({redirect:!0}),t=w()(e).userId,this.props.getUserById(t).then((function(){return a.setState({name:a.props.currentUser.name,email:a.props.currentUser.email,avatar:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+a.props.currentUser.avatar})}));case 4:case"end":return n.stop()}}),null,this)}},{key:"render",value:function(){return s.a.createElement(Be.ValidatorForm,{onSubmit:this.handleSubmit,style:{marginBottom:32}},s.a.createElement("h1",{style:{marginBottom:24}},"Your profile"),s.a.createElement(re.a,{src:this.state.avatar,style:{marginBottom:16,width:150,height:150}}),s.a.createElement("input",{accept:"image/*",id:"outlined-button-file",type:"file",style:{display:"none"},onChange:this.handleUpload}),s.a.createElement("label",{htmlFor:"outlined-button-file"},s.a.createElement(O.a,{variant:"outlined",component:"span",style:{width:150,marginBottom:32}},"Upload")),s.a.createElement(Be.TextValidator,{name:"name",label:"Your name",variant:"outlined",value:this.state.name,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required"],errorMessages:["This field is required"]}),s.a.createElement(Be.TextValidator,{name:"email",label:"Your email",variant:"outlined",value:this.state.email,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","isEmail"],errorMessages:["This field is required","Email is not valid"]}),s.a.createElement(O.a,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0},"Update profile data"),null!=this.state.error?s.a.createElement("h3",{className:"text-error"},this.state.error):null)}}]),t}(s.a.Component),ze=Object(i.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{getUserById:function(t){return e(q(t))},updateUser:function(t){return e((a=t,function(){var e;return T.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=new FormData).set("file",a.file),e.set("file_name",a.fileName),e.set("name",a.name),e.set("email",a.email),t.next=7,T.a.awrap(N.put("/users",e));case 7:case"end":return t.stop()}}))}));var a}}}))(Re);var Ve=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(v.a,null,s.a.createElement(L,null),s.a.createElement(y.a,null,s.a.createElement(E.d,null,s.a.createElement(E.b,{exact:!0,path:"/"},s.a.createElement(Me,null)),s.a.createElement(E.b,{path:"/profile"},s.a.createElement(ze,null)),s.a.createElement(E.b,{path:"/login"},s.a.createElement(Le,null)),s.a.createElement(E.b,{path:"/register"},s.a.createElement(We,null))))))},Pe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function He(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Ye=a(19),Ge=Object(Ye.a)();l.a.render(s.a.createElement(E.c,{history:Ge},s.a.createElement(i.a,{store:f},s.a.createElement(Ve,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Pe?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):He(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):He(t,e)}))}}()}},[[141,1,2]]]);
//# sourceMappingURL=main.e5633313.chunk.js.map