(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{140:function(e,t,a){e.exports=a(210)},149:function(e,t,a){},171:function(e,t,a){},200:function(e,t){},210:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(8),l=a.n(r),c=a(29),i=a(55),o=a(120),u="ADD_CHAT",m={currentUser:{},users:[],chats:[],messages:{}};var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;return t.type===u?Object.assign({},e,{chats:e.chats.concat(t.payload)}):"CHATS_LOADED"===t.type?Object.assign({},e,{chats:e.chats=t.payload}):"USERS_LOADED"===t.type?Object.assign({},e,{users:e.users.concat(t.payload)}):"MESSAGES_LOADED"===t.type?Object.assign({},e,{messages:Object.assign(e.messages,t.payload)}):"ADD_MESSAGE"===t.type?Object.assign({},e,{message:e.messages[t.payload.chat_id].push(t.payload)}):"USER_LOADED"===t.type?Object.assign({},e,{user:e.currentUser=Object(o.a)({},e.currentUser,{},t.payload)}):"LOGOUT"===t.type?Object.assign({},e,{users:e.currentUser={}}):e},h=a(121),g=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.c,p=Object(i.d)(d,g(Object(i.a)(h.a))),f=(a(149),a(33)),E=a(26),v=a(271),y=a(49),b=a.n(y),S=a(250),x=a(253),w=a(255),C=a(58),O=a(256),j=a(124),I=a.n(j),D=a(7),_=a(13),k=a.n(_),T=a(122),U=a.n(T),F=localStorage.getItem("token")||"",N=U.a.create({baseURL:"http://localhost:5000",headers:{"x-access-token":F}});function A(e){return function(t){var a,n;return k.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,k.a.awrap(N.post("/chats",{name:e.name,created_by:e.created_by,users:e.users}));case 2:a=s.sent,n={id:a.data.chat,name:e.name,users:e.users},t({type:u,payload:n});case 5:case"end":return s.stop()}}))}}function M(e){return function(t){var a;return k.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k.a.awrap(N.get("/users/"+e));case 2:a=n.sent,t({type:"USER_LOADED",payload:a.data.user});case 4:case"end":return n.stop()}}))}}var q=Object(S.a)((function(e){return{title:{marginRight:"auto"},icon:{position:"relative",top:5,paddingRight:5}}}));var B=function(e){var t=Object(E.g)(),a=Object(c.c)(),n=localStorage.getItem("token");null!==n&&a(M(b()(n).userId));var r=q();return s.a.createElement(x.a,{position:"static",color:"primary"},s.a.createElement(w.a,null,s.a.createElement(C.a,{variant:"h6",component:f.b,to:"/",className:r.title},s.a.createElement(I.a,{className:r.icon}),"ReactChat"),null===n?s.a.createElement(s.a.Fragment,null,s.a.createElement(O.a,{color:"inherit",component:f.b,to:"/login"},"Login"),s.a.createElement(O.a,{color:"inherit",component:f.b,to:"/register"},"Register")):s.a.createElement(s.a.Fragment,null,s.a.createElement(O.a,{color:"inherit",component:f.b,to:"/profile"},"Profile"),s.a.createElement(O.a,{color:"inherit",onClick:function(){a((function(e){e({type:"LOGOUT"})})),localStorage.removeItem("token"),t.push("/login")}},"Logout"))))},L=a(12),R=a(27),z=a(16),W=a(39),V=a(40),P=a(42),Y=(a(171),a(125)),G=a.n(Y),H=a(35),J=a(274),X=a(257),$=a(266),K=a(258),Q=a(118),Z=a(260),ee=a(261),te=a(264),ae=a(263),ne=a(262),se=a(272),re=a(275);var le=function(e){var t=e.open,a=e.onClose,n=e.userId,r=e.users;s.a.useEffect((function(){if(0!==r.length){var e=r.findIndex((function(e){return e.id===n}));r.splice(e,1)}}),[n,r]);var l=s.a.useState([]),i=Object(H.a)(l,2),o=i[0],u=i[1],m=s.a.useState(""),d=Object(H.a)(m,2),h=d[0],g=d[1],p=s.a.useState(!1),f=Object(H.a)(p,2),E=f[0],v=f[1],y=Object(c.c)();return s.a.createElement(J.a,{"aria-labelledby":"modal-create",open:t,onClose:a},s.a.createElement(X.a,{id:"simple-dialog-title",style:{width:"480px"}},"Create a new chat"),s.a.createElement(K.a,null,s.a.createElement(Q.a,{autoFocus:!0,id:"name",label:"Enter chat name",type:"text",variant:"outlined",fullWidth:!0,style:{marginBottom:16},onChange:function(e){var t;t=e.target.value,g(t),v(!1)},error:E}),s.a.createElement(Z.a,{dense:!0},r.map((function(e,t){var a,n="checkbox-list-secondary-label-".concat(e.id);return s.a.createElement(ee.a,{key:e.id,button:!0},s.a.createElement(ne.a,null,s.a.createElement(re.a,{src:e.avatar})),s.a.createElement(ae.a,{id:n,primary:e.name}),s.a.createElement(te.a,null,s.a.createElement(se.a,{edge:"end",onChange:(a=e.id,function(){var e=o.indexOf(a),t=Object(L.a)(o);-1===e?t.push(a):t.splice(e,1),u(t)}),checked:-1!==o.indexOf(e.id),inputProps:{"aria-labelledby":n}})))})))),s.a.createElement($.a,null,s.a.createElement(O.a,{onClick:a},"Cancel"),s.a.createElement(O.a,{onClick:function(){""!==h?(v(!1),y(A({name:h,created_by:n,users:o})).then((function(){return a()}))):v(!0)},color:"primary"},"Create")))},ce=a(57),ie=a.n(ce),oe=a(211),ue=a(259),me=a(265),de=a(267),he=a(126),ge=a.n(he),pe=a(127),fe=a.n(pe),Ee=a(128),ve=a.n(Ee),ye=a(129),be=a.n(ye);function Se(e){var t=e.id,a=e.name,n=e.avatar,r=e.own,l=e.type,c=e.handleEdit,i=e.handleDelete,o=e.createdAt,u=s.a.useState(e.text),m=Object(H.a)(u,2),d=m[0],h=m[1],g=s.a.useState(!1),p=Object(H.a)(g,2),f=p[0],E=p[1],v=s.a.useState(""),y=Object(H.a)(v,2),b=y[0],S=y[1],x=s.a.useState(e.edited),w=Object(H.a)(x,2),O=w[0],j=w[1],I=function(e){if("true"===r){var t=e.currentTarget.querySelector("span.message-text").innerHTML;S(t),E(!0)}},D=function(e){var t=e.split("_");return t.shift(),t.join("_")};return s.a.createElement(oe.a,{className:"chat-message "+("true"===r?"chat-message-own ":null)+(f?"full-width":null)},"image/jpeg"===l||"image/png"===l||"image/webp"===l||"image/gif"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{alt:d,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+d,style:{width:"100%",marginTop:8}}),s.a.createElement("span",{className:"created-at"},ie.a.format(new Date(o))))})):"text"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),f?s.a.createElement(ue.a,{defaultValue:b,autoFocus:!0,onBlur:function(e){var a=e.currentTarget;a.value!==d&&""!==a.value?(c(a.value,t),h(a.value),setTimeout((function(){E(!1)}),100),j(!0)):setTimeout((function(){E(!1)}),100)},style:{width:"100%"},endAdornment:s.a.createElement(de.a,{position:"end"},s.a.createElement(me.a,{edge:"end",onClick:function(){i(t)}},s.a.createElement(ge.a,{className:"message-delete"})))}):s.a.createElement(ae.a,{onDoubleClick:I,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(C.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("span",{className:"message-text"},d),O?s.a.createElement(C.a,{variant:"caption"},"edited"):null,s.a.createElement("span",{className:"created-at"},ie.a.format(new Date(o)))))})):"application/pdf"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{onDoubleClick:I,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(C.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("a",{className:"message-pdf",href:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+d},s.a.createElement(fe.a,null),D(d)),s.a.createElement("span",{className:"created-at"},ie.a.format(new Date(o)))))})):"application/x-zip-compressed"===l?s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{onDoubleClick:I,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(C.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("a",{className:"message-pdf",href:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+d},s.a.createElement(ve.a,null),D(d)),s.a.createElement("span",{className:"created-at"},ie.a.format(new Date(o)))))})):s.a.createElement(ee.a,{alignItems:"flex-start"},"false"!==r?null:s.a.createElement(ne.a,null,s.a.createElement(re.a,{alt:a,src:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+n})),s.a.createElement(ae.a,{onDoubleClick:I,primary:"false"!==r?null:a,secondary:s.a.createElement(s.a.Fragment,null,s.a.createElement(C.a,{component:"span",variant:"body2",color:"textPrimary"},s.a.createElement("a",{className:"message-pdf",href:"https://nodejschat.s3.eu-central-1.amazonaws.com/messages/"+d},s.a.createElement(be.a,null),D(d)),s.a.createElement("span",{className:"created-at"},ie.a.format(new Date(o)))))})))}var xe=a(268),we=a(269),Ce=a(213),Oe=a(270),je=a(132),Ie=a.n(je),De=a(130),_e=a.n(De),ke=a(131),Te=a.n(ke),Ue=G.a.connect("http://localhost:5000");var Fe=function(e){function t(e){var a;return Object(R.a)(this,t),(a=Object(W.a)(this,Object(V.a)(t).call(this,e))).handleUploadChat=function(e){var t=e.currentTarget.files[0],n=(new Date).getTime()+"_"+t.name;Ue.emit("chat file",{file:t,fileType:t.type,fileName:n,userId:a.state.userId,chatId:a.state.selectedChatId},(function(){a.setState({messages:[].concat(Object(L.a)(a.state.messages),[{created_at:new Date,text:n,chat_id:a.state.selectedChatId,user_id:a.state.userId,edited:!1,type:t.type,own:"true"}]),messagesFiltered:[].concat(Object(L.a)(a.state.messagesFiltered),[{created_at:new Date,text:n,chat_id:a.state.selectedChatId,user_id:a.state.userId,edited:!1,type:t.type,own:"true"}])})}))},a.state={redirect:!1,error:null,selectedIndex:0,selectedChatId:0,open:!1,userId:0,chats:[],chatsFiltered:[],messages:[],messagesFiltered:[],loadingChats:!0,loadingMessages:!0,access:!1,requestSent:!1},a.sendInput=s.a.createRef(),a.messagesDiv=s.a.createRef(),a.getChats=null,a}return Object(P.a)(t,e),Object(z.a)(t,[{key:"componentDidMount",value:function(){var e,t=this;return k.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:null===(e=localStorage.getItem("token"))?this.setState({redirect:!0}):this.setState({userId:b()(e).userId}),this.props.getChats().then((function(){if(0!==t.props.chats.length){var a=t.props.chats[0].id,n=b()(e).userId;t.setState({selectedChatId:a,loadingChats:!1}),Ue.emit("get access",{chatId:a,userId:n})}else t.setState({loadingChats:!1,loadingMessages:!1})})),Ue.on("get access",(function(e){t.setState({access:e}),e&&Ue.emit("get messages",{userId:t.state.userId,chatId:t.state.selectedChatId})})),Ue.on("get messages",(function(e){t.setState({messages:e,messagesFiltered:e,loadingMessages:!1},(function(){t.messagesDiv.current.scrollTop=t.messagesDiv.current.scrollHeight}))})),Ue.on("chat message",(function(e){t.setState({messages:[].concat(Object(L.a)(t.state.messages),[e]),messagesFiltered:[].concat(Object(L.a)(t.state.messages),[e])})})),Ue.on("edit message",(function(e){t.setState({loadingMessages:!0});var a=Object(L.a)(t.state.messages),n=a.findIndex((function(t){return t.id===e.id}));a[n]=e,t.setState({messages:a,messagesFiltered:a,loadingMessages:!1})})),Ue.on("delete message",(function(e){t.setState({loadingMessages:!0});var a=Object(L.a)(t.state.messages),n=a.findIndex((function(t){return t.id===e}));a.splice(n,1),t.setState({messages:a,messagesFiltered:a,loadingMessages:!1})})),Ue.on("get access",(function(e){e?(Ue.emit("get messages",{userId:t.state.userId,chatId:t.state.selectedChatId}),t.setState({access:e})):t.setState({access:e,loadingMessages:!1})})),this.props.getUsers();case 10:case"end":return a.stop()}}),null,this)}},{key:"handleSearchChat",value:function(e){var t=Object(L.a)(this.state.chats);""===e&&this.setState({chatsFiltered:t});var a=t.filter((function(t){return t.name.toLowerCase().includes(e)}));this.setState({chatsFiltered:a})}},{key:"handleSearchMessage",value:function(e){var t=Object(L.a)(this.state.messages);""===e&&this.setState({messagesFiltered:t});var a=t.filter((function(t){return t.text.toLowerCase().includes(e)}));this.setState({messagesFiltered:a})}},{key:"handleSendMessage",value:function(){var e;return k.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k.a.awrap(this.sendInput.current.querySelector("input"));case 2:if(""!==(e=t.sent).value){t.next=5;break}return t.abrupt("return");case 5:Ue.emit("chat message",{userId:this.state.userId,chatId:this.state.selectedChatId,text:e.value}),this.setState({messages:[].concat(Object(L.a)(this.state.messages),[{created_at:new Date,text:e.value,chat_id:this.state.selectedChatId,user_id:this.state.userId,edited:!1,type:"text",own:"true"}]),messagesFiltered:[].concat(Object(L.a)(this.state.messagesFiltered),[{created_at:new Date,text:e.value,chat_id:this.state.selectedChatId,user_id:this.state.userId,edited:!1,type:"text",own:"true"}])}),e.value="";case 8:case"end":return t.stop()}}),null,this)}},{key:"render",value:function(){var e=this;if(this.state.redirect)return s.a.createElement(E.a,{to:"/login"});var t=function(t,a){Ue.emit("edit message",{text:t,messageId:a,chatId:e.state.selectedChatId})},a=function(t){Ue.emit("delete message",{messageId:t,chatId:e.state.selectedChatId})};return s.a.createElement(oe.a,{style:{marginTop:32,height:"624px",marginBottom:32}},s.a.createElement(xe.a,{container:!0},s.a.createElement(xe.a,{item:!0,xs:3,style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"624px"}},s.a.createElement(Z.a,{component:"nav",className:"chat-list"},s.a.createElement(ee.a,{button:!0,style:{paddingTop:"12px",paddingBottom:"12px"},onClick:function(){e.setState({open:!0})},className:"btn-new-chat"},s.a.createElement(we.a,null,s.a.createElement(_e.a,null)),s.a.createElement(ae.a,{primary:"Create a new chat",className:"btn-new-chat-text"})),s.a.createElement("div",{className:"chats"},!0===this.state.loadingChats?s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(Oe.a,{color:"secondary",size:30,style:{textAlign:"center"}})):0===this.props.chats.length?s.a.createElement("h5",{style:{textAlign:"center"}},"There are no chats by this query"):this.props.chats.map((function(t,a){return s.a.createElement(ee.a,{key:a,button:!0,selected:e.state.selectedIndex===a,onClick:function(n){return function(t,a){e.setState({requestSent:!1}),Ue.emit("leave chat",{chatId:e.state.selectedChatId}),e.setState({selectedIndex:t,selectedChatId:a,loadingMessages:!0}),Ue.emit("get access",{chatId:a,userId:e.state.userId}),e.sendInput.current.querySelector("input").value=""}(a,t.id)}},s.a.createElement(ae.a,{primary:t.name}))})))),s.a.createElement(Q.a,{id:"chat-search",label:"Search by chat name",variant:"filled",fullWidth:!0,onChange:function(t){e.handleSearchChat(t.target.value)}})),s.a.createElement(xe.a,{item:!0,xs:9,style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"624px",borderLeft:"1px solid rgba(0, 0, 0, .14)"}},s.a.createElement(Q.a,{id:"message-search",label:"Search by message",variant:"filled",fullWidth:!0,onChange:function(t){e.handleSearchMessage(t.target.value)}}),s.a.createElement("div",{ref:this.messagesDiv,className:"chat-messages"},!0===this.state.loadingMessages?s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(Oe.a,{color:"secondary",style:{textAlign:"center"}})):this.state.access?0===this.state.messagesFiltered.length?s.a.createElement("h3",{style:{textAlign:"center"}},"There are no messages in this chat"):this.state.messagesFiltered.map((function(e,n){return s.a.createElement(Se,{key:n,id:e.id,name:e.name,avatar:e.avatar,text:e.text,own:e.own,type:e.type,edited:e.edited,handleEdit:t,handleDelete:a,createdAt:e.created_at})})):s.a.createElement(s.a.Fragment,null,s.a.createElement("h3",{style:{textAlign:"center"}},"You have no permission to join this chat"),this.state.requestSent?s.a.createElement("h4",{style:{textAlign:"center",marginTop:0}},"Request has been sent"):s.a.createElement(O.a,{variant:"contained",color:"secondary",onClick:function(){var t=e.props.chats.filter((function(t){return t.id===e.state.selectedChatId}));N.post("/request",{chat_id:e.state.selectedChatId,chat_name:t[0].name,user_id:e.state.userId,user_name:e.props.currentUser.name,user_email:e.props.currentUser.email}).then((function(){return e.setState({requestSent:!0})}))}},"Send a request to join"))),s.a.createElement(oe.a,{className:"message-form"},s.a.createElement(Ce.a,{className:"message-input",placeholder:"...",ref:this.sendInput}),s.a.createElement("input",{style:{display:"none"},id:"icon-button-file",type:"file",onChange:this.handleUploadChat}),s.a.createElement("label",{htmlFor:"icon-button-file"},s.a.createElement(me.a,{color:"primary","aria-label":"upload picture",component:"span"},s.a.createElement(Te.a,null))),s.a.createElement(me.a,{className:"message-icon","aria-label":"search",onClick:function(t){return e.handleSendMessage(t)}},s.a.createElement(Ie.a,{color:"primary"}))))),s.a.createElement(le,{open:this.state.open,onClose:function(){e.setState({open:!1})},userId:this.state.userId,users:this.props.users}))}}]),t}(s.a.Component),Ne=Object(c.b)((function(e){return{chats:e.chats,users:e.users,messages:e.messages,currentUser:e.currentUser}}),(function(e){return{addChat:function(t){return e(A(t))},getChats:function(){return e((function(e){var t;return k.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,k.a.awrap(N.get("/chats"));case 2:t=a.sent,e({type:"CHATS_LOADED",payload:t.data.chats});case 4:case"end":return a.stop()}}))}))},getUsers:function(){return e((function(e){var t;return k.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,k.a.awrap(N.get("/users"));case 2:t=a.sent,e({type:"USERS_LOADED",payload:t.data.users});case 4:case"end":return a.stop()}}))}))},getMessagesByChatId:function(t){return e(function(e){return function(t){var a,n;return k.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,k.a.awrap(N.get("chats/"+e+"/messages/"));case 2:a=s.sent,n=Object(D.a)({},e,a.data.messages),t({type:"MESSAGES_LOADED",payload:n});case 5:case"end":return s.stop()}}))}}(t))},sendMessage:function(t){return e((a=t,function(e){var t;return k.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k.a.awrap(N.post("/chats/messages",{chat_id:a.chat_id,text:a.text}));case 2:(t=n.sent).data.message.own="true",e({type:"ADD_MESSAGE",payload:t.data.message});case 5:case"end":return n.stop()}}))}));var a}}}))(Fe),Ae=a(18),Me=a(22),qe=function(e){function t(e){var a;return Object(R.a)(this,t),(a=Object(W.a)(this,Object(V.a)(t).call(this,e))).state={email:"",password:"",error:null},a.handleChange=a.handleChange.bind(Object(Ae.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(Ae.a)(a)),a}return Object(P.a)(t,e),Object(z.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name;this.setState(Object(D.a)({},a,t.value))}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),N.post("/login",{email:this.state.email,password:this.state.password}).then((function(e){localStorage.setItem("token",e.data.token),t.setState({redirect:!0})})).catch((function(e){return t.setState({error:e.response.data.message})}))}},{key:"render",value:function(){return this.state.redirect?s.a.createElement(E.a,{to:"/"}):s.a.createElement(Me.ValidatorForm,{onSubmit:this.handleSubmit,style:{marginBottom:32}},s.a.createElement("h1",{style:{marginBottom:24}},"Login"),s.a.createElement(Me.TextValidator,{name:"email",label:"Your email",variant:"outlined",value:this.state.email,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","isEmail"],errorMessages:["This field is required","Email is not valid"]}),s.a.createElement(Me.TextValidator,{name:"password",type:"password",label:"Password",variant:"outlined",value:this.state.password,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","minStringLength:6"],errorMessages:["This field is required","This field must be equal 6 or more symbols"]}),s.a.createElement(O.a,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0},"Sign In"),null!=this.state.error?s.a.createElement("h3",{className:"text-error"},this.state.error):null)}}]),t}(s.a.Component),Be=function(e){function t(e){var a;return Object(R.a)(this,t),(a=Object(W.a)(this,Object(V.a)(t).call(this,e))).state={name:"",email:"",password:"",redirect:!1,error:null},a.handleChange=a.handleChange.bind(Object(Ae.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(Ae.a)(a)),a}return Object(P.a)(t,e),Object(z.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name;this.setState(Object(D.a)({},a,t.value))}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),N.post("/register",{name:this.state.name,email:this.state.email,password:this.state.password}).then((function(e){t.setState({redirect:!0})})).catch((function(e){return t.setState({error:e.response.data.message})}))}},{key:"render",value:function(){return this.state.redirect?s.a.createElement(E.a,{to:"/login"}):s.a.createElement(Me.ValidatorForm,{onSubmit:this.handleSubmit,style:{marginBottom:32}},s.a.createElement("h1",{style:{marginBottom:24}},"Register"),s.a.createElement(Me.TextValidator,{name:"name",label:"Your name",variant:"outlined",value:this.state.name,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","minStringLength:2"],errorMessages:["This field is required","This field must be equal 2 or more symbols"]}),s.a.createElement(Me.TextValidator,{name:"email",label:"Your email",variant:"outlined",value:this.state.email,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","isEmail"],errorMessages:["This field is required","Email is not valid"]}),s.a.createElement(Me.TextValidator,{name:"password",type:"password",label:"Password",variant:"outlined",value:this.state.password,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","minStringLength:6"],errorMessages:["This field is required","This field must be equal 6 or more symbols"]}),s.a.createElement(O.a,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0},"Sign Up"),null!=this.state.error?s.a.createElement("h3",{className:"text-error"},this.state.error):null)}}]),t}(s.a.Component);var Le=function(e){function t(e){var a;return Object(R.a)(this,t),(a=Object(W.a)(this,Object(V.a)(t).call(this,e))).handleChange=function(e){var t=e.target,n=t.name;a.setState(Object(D.a)({},n,t.value))},a.handleSubmit=function(e){e.preventDefault(),""!==a.state.name&&""!==a.state.email&&a.props.updateUser({file:a.state.file,fileName:a.state.fileName,name:a.state.name,email:a.state.email})},a.handleUpload=function(e){e.preventDefault();var t=new FileReader,n=e.currentTarget.files[0];t.onloadend=function(){a.setState({file:n,fileName:a.props.currentUser.id+"_"+n.name,avatar:t.result})},t.readAsDataURL(n)},a.state={redirect:!1,error:null,name:"",email:"",avatar:null,file:null,fileName:""},a}return Object(P.a)(t,e),Object(z.a)(t,[{key:"componentDidMount",value:function(){var e,t,a=this;return k.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:(e=localStorage.getItem("token"))||this.setState({redirect:!0}),t=b()(e).userId,this.props.getUserById(t).then((function(){return a.setState({name:a.props.currentUser.name,email:a.props.currentUser.email,avatar:"https://nodejschat.s3.eu-central-1.amazonaws.com/"+a.props.currentUser.avatar})}));case 4:case"end":return n.stop()}}),null,this)}},{key:"render",value:function(){return s.a.createElement(Me.ValidatorForm,{onSubmit:this.handleSubmit,style:{marginBottom:32}},s.a.createElement("h1",{style:{marginBottom:24}},"Your profile"),s.a.createElement(re.a,{src:this.state.avatar,style:{marginBottom:16,width:150,height:150}}),s.a.createElement("input",{accept:"image/*",id:"outlined-button-file",type:"file",style:{display:"none"},onChange:this.handleUpload}),s.a.createElement("label",{htmlFor:"outlined-button-file"},s.a.createElement(O.a,{variant:"outlined",component:"span",style:{width:150,marginBottom:32}},"Upload")),s.a.createElement(Me.TextValidator,{name:"name",label:"Your name",variant:"outlined",value:this.state.name,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required"],errorMessages:["This field is required"]}),s.a.createElement(Me.TextValidator,{name:"email",label:"Your email",variant:"outlined",value:this.state.email,onChange:this.handleChange,fullWidth:!0,style:{marginBottom:16},validators:["required","isEmail"],errorMessages:["This field is required","Email is not valid"]}),s.a.createElement(O.a,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0},"Update profile data"),null!=this.state.error?s.a.createElement("h3",{className:"text-error"},this.state.error):null)}}]),t}(s.a.Component),Re=Object(c.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{getUserById:function(t){return e(M(t))},updateUser:function(t){return e((a=t,function(e){var t;return k.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).set("file",a.file),t.set("file_name",a.fileName),t.set("name",a.name),t.set("email",a.email),e.next=7,k.a.awrap(N.put("/users",t));case 7:case"end":return e.stop()}}))}));var a}}}))(Le);var ze=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(f.a,null,s.a.createElement(B,null),s.a.createElement(v.a,null,s.a.createElement(E.d,null,s.a.createElement(E.b,{exact:!0,path:"/"},s.a.createElement(Ne,null)),s.a.createElement(E.b,{path:"/profile"},s.a.createElement(Re,null)),s.a.createElement(E.b,{path:"/login"},s.a.createElement(qe,null)),s.a.createElement(E.b,{path:"/register"},s.a.createElement(Be,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var We=a(19),Ve=Object(We.a)();l.a.render(s.a.createElement(E.c,{history:Ve},s.a.createElement(c.a,{store:p},s.a.createElement(ze,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[140,1,2]]]);
//# sourceMappingURL=main.89b3ce28.chunk.js.map